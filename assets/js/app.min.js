var sum = 300000;
var len = 1;

var perc = 0.2085
var multiplier = 4

new WOW().init();
$(".anchor").on("click", function (event) {
  event.preventDefault();
  var id  = $(this).attr('href'),
  top = $(id).offset().top;
  $('body,html').animate({scrollTop: top - 100}, 1000);
});
document.addEventListener('DOMContentLoaded', function(){ // Аналог $(document).ready(function(){
$('.calc-tabs-btn').on('click', function(){
  perc = Number($(this).data('p'))
  multiplier = Number($(this).data('mult'))
  $('.calc-tabs-btn').removeClass('active')
  $(this).addClass('active')
  calculate();
})


$('.cases-slide__img-slider').slick({
  infinite: true,
  slidesToShow: 1,
  slidesToScroll: 1,
  fade: true,
  autoplay: true,
  autoplaySpeed: 2000,
  draggable: false,
  arrows: false,
  dots: true,
  lazyload: 'ondemand'
});

$('.cases-slider').slick({
  infinite: true,
  slidesToShow: 1,
  slidesToScroll: 1,
  arrows: true,
  dots: false,
});

  $("#calc-sum").slider({
    range: "min",
    value: 300000,
    min: 300000,
    max: 10000000,
    step: 10000,
    animate:true,
    slide: function( event, ui ) {
        sum = ui.value;
        $('#sum-val').html(ui.value)
        calculate();
    },
    change: function( event, ui ){
      sum = ui.value;
      sum = ui.value;
      $('#sum-val').html(ui.value)
      calculate();
    },
    stop: function( event, ui ) {}
  });
  $("#calc-len").slider({
    range: "min",
    value: 1,
    min: 1,
    max: 10,
    step: 1,
    animate:true,
    slide: function( event, ui ) {
        len = ui.value;
        $('#val-y').html(ui.value)
        if (ui.value == 1){
          $('#name-y').html('год')
        }
        else if (ui.value < 5){
          $('#name-y').html('года')
        }
        if (ui.value >= 5){
          $('#name-y').html('лет')
        }
        calculate();
    },
    change: function( event, ui ){
      len = ui.value;
      $('#val-y').html(ui.value)
      if (ui.value == 1){
        $('#name-y').html('год')
      }
      else if (ui.value < 5){
        $('#name-y').html('года')
      }
      if (ui.value >= 5){
        $('#name-y').html('лет')
      }
      calculate();
    },
    stop: function( event, ui ) {}
  });


  $(".calc__ui-val").keypress(function(e) {
    if (isNaN(String.fromCharCode(e.which))) e.preventDefault();
  });

  

  // $("#sum-val").on('blur', function(e) {
  //   var val = Number($(this).html())
  //   $("#calc-sum").slider("value", val);
  // });

  // $("#len-val").on('blur', function(e) {
  //   var val = Number($(this).html())
  //   $("#calc-len").slider("value", val);
  // });

  $('[data-p]').on('click', function(){
    let id = $(this).data('p')
    $('#'+id).fadeIn()
  })

  $('.popup-wrap, .close').on('click', function(e){
    if (e.target == this){
      $(this).closest('.popup').fadeOut();
    }
  })

  $('input[name="phone"]').mask("+7(999) 999-99-99");

  $('form').on('submit', function(e){
    e.preventDefault();
    var fd = new FormData(this);
    var btn = $(this).find('.btn')
    $(btn).prop('disabled', true)
    $.ajax({
          url: 'amo.php',
          data: fd,
          processData: false,
          contentType: false,
          type: 'POST',
          success: function (response) {
            $(btn).prop('disabled', false)
            $('.popup').fadeOut()
            $('#p-thx').fadeIn()
          }
    });
  })

});


// var
// 25,3

function calculate(){
  s = sum * Math.pow((1 + (perc/multiplier)), len * multiplier)
  inc = s - sum
  $('#calc-res').html(prettify(Math.round(s / 10) * 10))
  $('#calc-inc').html(prettify(Math.round(inc / 10) * 10))
}

function prettify (num) {
  var n = num.toString();
  var separator = " ";
  return n.replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g, "$1" + separator);
}

calculate()



  jQuery('img.svg').each(function(){
      var $img = jQuery(this);
      var imgID = $img.attr('id');
      var imgClass = $img.attr('class');
      var imgURL = $img.attr('src');
      jQuery.get(imgURL, function(data) {
          var $svg = jQuery(data).find('svg');
  
          if(typeof imgID !== 'undefined') {
              $svg = $svg.attr('id', imgID);
          }
          if(typeof imgClass !== 'undefined') {
              $svg = $svg.attr('class', imgClass+' replaced-svg');
          }
          $svg = $svg.removeAttr('xmlns:a');
          if(!$svg.attr('viewBox') && $svg.attr('height') && $svg.attr('width')) {
              $svg.attr('viewBox', '0 0 ' + $svg.attr('height') + ' ' + $svg.attr('width'))
          }
          $img.replaceWith($svg);
  
      }, 'xml');
  });

$(window).on('scroll', function(){


  if ($(window).scrollTop() > $('#graph').offset().top){
    $('.graph-content').addClass('animated')
  }

})


$('a[href="#policy"]').on('click', function(e){

  e.preventDefault()
  $('#p-policy').fadeIn()
})



$(".calc__ui-val").keypress(function (e) {
  if (e.keyCode === 13) {
      var val = Number($(this).html());
      $("#calc-sum").slider("value", val);
      return false;
  }
  if (!(e.keyCode >= 48 && e.keyCode <= 57) && !(e.keyCode >= 96 && e.keyCode <= 105)) {
    e.preventDefault();
  }
}); 
$("#sum-val").on('focus', function (e) {
  $(this).html('')
});
$("#sum-val").on('blur', function (e) {
  var val = Number($(this).html());
  $("#calc-sum").slider("value", val);
});
$("#val-y").on('blur', function (e) {
  var val = Number($(this).html());
  $("#calc-len").slider("value", val);
});